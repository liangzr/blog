<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¦‚ä½•æŒ‰åŸé¡ºåºæ‰“å°å‡ºå¯¹è±¡çš„å±æ€§ï¼Ÿ</title>
      <link href="/2019/03/09/how_to_print_properties_of_the_object_by_originally/"/>
      <url>/2019/03/09/how_to_print_properties_of_the_object_by_originally/</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©åœ¨ç¾¤é‡Œçœ‹åˆ°æœ‰äººé—®:</p><blockquote><p>ç½‘å‹ï¼šâ€œ<strong>Object.keysä¼šç»™å€¼æ’åºï¼Œé‚£ç”¨å“ªä¸ªæ–¹æ³•å–å¯¹è±¡å±æ€§èƒ½ä¸æ’åºçš„ï¼Ÿ</strong>â€<br>æˆ‘ï¼šâ€œå¯¹è±¡çš„å±æ€§æœ‰é¡ºåºå—ï¼Ÿâ€<br>ç½‘å‹ï¼šâ€œè¿™ä¸ªå°±ä¼šæŒ‰ç…§ä»å°åˆ°å¤§æ’åºï¼Œæˆ‘åªæ˜¯æƒ³ä¿æŒåŸæ ·~~â€ (å¦‚ä¸‹)<br>æˆ‘ï¼šâ€forâ€¦in åº”è¯¥ä¸ä¼šâ€<br>â€¦â€¦</p></blockquote><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1g0wixmegiij30gk02vglu.jpg" alt></p><p>ç»“æœæˆ‘è¯•äº†ä¸‹å‘ç° <code>for..in</code> ä¹Ÿä¼šï¼Œæœ€ç»ˆæˆ‘è¯•äº†å…­ç§æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="number">100</span>: <span class="string">'a'</span>, <span class="number">2</span>: <span class="string">'b'</span>, <span class="number">7</span>: <span class="string">'c'</span> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">Object</span>.keys(obj)                          <span class="comment">// ["2", "7", "100"]</span></span><br><span class="line"><span class="built_in">Object</span>.values(obj)                        <span class="comment">// ["b", "c", "a"]</span></span><br><span class="line"><span class="built_in">Object</span>.entries(obj)                       <span class="comment">// "2,b,7,c,100,a", toString() ä¹‹å</span></span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> obj) &#123; <span class="built_in">console</span>.log(key) &#125;     <span class="comment">// 2, 7, 10</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj)           <span class="comment">// ["2", "7", "100"]</span></span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(obj)                      <span class="comment">// ["2", "7", "100"]</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä¸Šæ–¹æ³•éƒ½æ— ä¸€ä¾‹å¤–åœ°ä»¥ <code>{ 2: &#39;b&#39;, 7: &#39;c&#39;, 100: &#39;a&#39; }</code> çš„æ–¹å¼æ‰“å°å‡ºäº†ç›¸å…³å€¼ï¼Œé‚£è¿™ä¸ªé—®é¢˜çš„å½±å“åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><a id="more"></a><p>å‡å¦‚ä½ ä»æ¥å£ä¸­è·å–ä¸€æ®µ JSON æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"100"</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="string">"2"</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="string">"7"</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸ªæ•°æ®å¯èƒ½æ˜¯ç»è¿‡åç«¯æ’åºçš„ï¼Œå¹¶ä¸”æ•°æ®ä¸­å¹¶æ²¡æœ‰å¸¦æœ‰å¯ä¾›æ’åºçš„ä¿¡æ¯ï¼Œæ¯«æ— ç–‘é—®ç»è¿‡ JS çš„é‡æ–°æ’åºåï¼Œå®ƒçš„æ’åºä¿¡æ¯å°±ä¸¢å¤±äº†ï¼Œå‡å¦‚æˆ‘å°±æ˜¯ä¸æƒ³ä¸¢å¤±å‘¢ï¼Ÿ</p><p>æ¬²çŸ¥å…¶ç„¶ï¼Œå…ˆçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚åœ¨äº†è§£å®ƒå¦‚æœéå†å±æ€§ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œåœ¨ V8 ä¸­å¯¹è±¡æ˜¯å¦‚ä½•å­˜å‚¨å±æ€§çš„å‘¢ï¼Ÿ</p><h2 id="V8-ä¸­å¯¹è±¡çš„å±æ€§"><a href="#V8-ä¸­å¯¹è±¡çš„å±æ€§" class="headerlink" title="V8 ä¸­å¯¹è±¡çš„å±æ€§"></a>V8 ä¸­å¯¹è±¡çš„å±æ€§</h2><p>åœ¨ JavaScript ä¸­ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å¯¹è±¡çš„è¡Œä¸ºç±»ä¼¼ä¸€ä¸ªå­—å…¸ï¼Œå®ƒä»¥å­—ç¬¦ä¸²åšä¸ºé”®åï¼Œä»¥ä»»æ„å¯¹è±¡ä½œä¸ºå€¼ã€‚è™½ç„¶åœ¨è¿­ä»£çš„æ—¶å€™ï¼Œè§„èŒƒçº¦å®šäº†ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†æ•´æ•°ç´¢å¼•å±æ€§å’Œå…¶ä»–å±æ€§ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸‹æ•´æ•°ç´¢å¼•å±æ€§å’Œå‘½åå±æ€§çš„åŒºåˆ«ã€‚</p><h3 id="Named-properties-vs-elements"><a href="#Named-properties-vs-elements" class="headerlink" title="Named properties vs. elements"></a>Named properties vs. elements</h3><p>å…ˆæ¥å‡è®¾ä¸€ä¸ªç®€å•çš„å¯¹è±¡ <code>{a: &#39;foo&#39;, b: &#39;bar&#39;}</code>ã€‚è¯¥å¯¹è±¡æœ‰ä¸¤ä¸ªå‘½åå±æ€§,<code>a</code> å’Œ <code>b</code>ï¼Œå®ƒæ²¡æœ‰æ•´æ•°ç´¢å¼•ã€‚æ•´æ•°ç´¢å¼•å±æ€§ï¼ˆé€šå¸¸å«åšå…ƒç´ elementï¼‰åœ¨æ•°ç»„ä¸­æ¯”è¾ƒå¸¸è§ï¼Œå¦‚ <code>[&#39;foo&#39;, &#39;bar&#39;]</code> æœ‰ä¸¤ä¸ªæ•´æ•°ç´¢å¼•ï¼Œåˆ†åˆ«ä¸º 0 å’Œ 1ã€‚è¿™æ˜¯ V8 å¤„ç†å±æ€§çš„ç¬¬ä¸€ä¸ªä¸»è¦åŒºåˆ«ã€‚</p><p><img src="https://v8.dev/_img/fast-properties/jsobject.png" alt></p><p>å…ƒç´ å’Œå±æ€§å­˜å‚¨åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®ç»“æ„ä¸­ï¼Œè¿™ä½¿å¾—æ·»åŠ å’Œè®¿é—®å±æ€§æˆ–å…ƒç´ ï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸‹éƒ½æ›´æœ‰æ•ˆç‡ã€‚</p><p>å…ƒç´ ä¸»è¦ç”¨äº <code>Array.prototype</code> çš„å„ç§æ–¹æ³•ï¼Œé‰´äºè¿™äº›å‡½æ•°è®¿é—®çš„æ˜¯è¿èŒƒå›´å†…çš„å±æ€§ï¼ŒV8 åœ¨å†…éƒ¨ä¹Ÿå°†ä»–ä»¬è¡¨ç¤ºä¸ºç®€å•æ•°ç»„ï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯è¿™æ ·çš„ï¼Œæœ‰æ—¶ä¼šåˆ‡æ¢åˆ°åŸºäºç¨€ç–å­—å…¸çš„å½¢å¼æ¥èŠ‚çœå†…å­˜ï¼‰</p><p>å‘½åå±æ€§ä»¥ç±»ä¼¼çš„æ–¹å¼å­˜å‚¨åœ¨å•ç‹¬çš„æ•°ç»„ä¸­ã€‚ä½†æ˜¯ä¸å…ƒç´ ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç®€å•çš„é”®æ¥æ¨æ–­ä»–ä»¬åœ¨å±æ€§æ•°ç»„ä¸­çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®ã€‚åœ¨ V8 ä¸­ï¼Œæ¯ä¸ª JavaScript å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ HiddenClassï¼Œå®ƒç”¨æ¥å­˜å‚¨å¯¹è±¡çš„ç»“æ„ä¿¡æ¯ï¼Œä»¥åŠä»å±æ€§ååˆ°å±æ€§æ•°ç»„çš„ç´¢å¼•çš„ä¸€ä¸ªæ˜ å°„å…³ç³»ã€‚å¯¹äºå¤æ‚çš„æƒ…å†µï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸€ä¸ªå­—å…¸æ¥å­˜å‚¨å±æ€§ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„æ•°ç»„ã€‚</p><blockquote><p>æ›´è¯¦ç»†çš„å†…å®¹è¯·é˜…è¯» V8 åšå®¢çš„æ–‡ç«  <a href="https://v8.dev/blog/fast-properties" target="_blank" rel="noopener">Fast properties in V8</a></p></blockquote><h2 id="å¦‚ä½•éå†å¯¹è±¡çš„å±æ€§"><a href="#å¦‚ä½•éå†å¯¹è±¡çš„å±æ€§" class="headerlink" title="å¦‚ä½•éå†å¯¹è±¡çš„å±æ€§"></a>å¦‚ä½•éå†å¯¹è±¡çš„å±æ€§</h2><p>é€šè¿‡æŸ¥è¯¢ ECMA 262 è§„èŒƒæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€èŠ‚ä¸­æˆ‘ä»¬ä½¿ç”¨çš„å…­ç§éå†å±æ€§çš„æ–¹æ³•ï¼Œåœ¨ç±»ä¼¼çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆéƒ½ä¼šè¿”å› <code>Obj.[[OwnPropertyKeys]]</code> çš„ç»“æœã€‚</p><p>æŒ‰ç…§ ECMA 262 ä¸­å¯¹ <code>[[OwnPropertyKeys]]</code> çš„<a href="https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-ownpropertykeys" target="_blank" rel="noopener">å®šä¹‰</a>ï¼š</p><blockquote><p>When the <code>[[OwnPropertyKeys]]</code> internal method of O is called, the following steps are taken:</p><ol><li>Return ! OrdinaryOwnPropertyKeys(O).</li></ol></blockquote><p>å®ƒè¿”å›äº†ä¸€ä¸ª <code>OrdinaryOwnPropertyKeys(O)</code> çš„å¤„ç†ç»“æœï¼Œè€Œ <code>OrdinaryOwnPropertyKeys(O)</code> çš„æ‰§è¡Œè¿‡ç¨‹åˆ™æ˜¯ï¼š</p><blockquote><p>When the abstract operation OrdinaryOwnPropertyKeys is called with Object O, the following steps are taken:</p><ol><li>Let <code>keys</code> be a new empty List.</li><li>For each own property key <code>P</code> of <code>O</code> that is an array index, in ascending numeric index order, do<br>a. Add <code>P</code> as the last element of <code>keys</code>.</li><li>For each own property key <code>P</code> of <code>O</code> that is a String but is not an array index, in ascending chronological order of property creation, do<br>a. Add <code>P</code> as the last element of <code>keys</code>.</li><li>For each own property key <code>P</code> of <code>O</code> that is a Symbol, in ascending chronological order of property creation, do<br>b. Add P as the last element of <code>keys</code>.</li><li>Return <code>keys</code>.</li></ol></blockquote><p>æˆ‘ä»¬æ¥ç®€å•æè¿°ä¸‹ä¸Šè¿°è¿‡ç¨‹å°±æ˜¯ï¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º <code>keys</code> çš„ç©ºæ•°ç»„ï¼Œç„¶åå…ˆéå†å¯¹è±¡ä¸­çš„æ•°ç»„ç´¢å¼•çš„å±æ€§ï¼Œç»“æœä»¥å‡åºæ’åˆ—ï¼Œå¹¶é€ä¸ªæ”¾å…¥ <code>keys</code> ä¸­ï¼›å†éå†å­—ç¬¦ä¸²å±æ€§ï¼ˆä½†ä¸æ˜¯æ•°ç»„ç´¢å¼•ï¼‰ï¼Œä»¥å±æ€§åˆ›å»ºæ—¶é—´å‡åºæ’åˆ—ï¼Œå¹¶é€ä¸ªæ”¾å…¥ <code>keys</code> ä¸­å»ï¼›ç„¶åå†éå† Symbol ç±»å‹çš„å±æ€§åï¼ŒåŒæ ·ä»¥å±æ€§åˆ›å»ºæ—¶é—´å‡åºæ’åˆ—ï¼Œæ”¾å…¥ <code>keys</code> ä¸­ï¼Œæœ€åè¿”å› <code>keys</code> æ•°ç»„ã€‚</p><p>ä¸‹æ¥æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  b: <span class="number">1</span>,</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">3</span>,</span><br><span class="line">  <span class="number">7</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="number">10</span>: <span class="number">6</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="string">'a'</span>)]: <span class="number">7</span></span><br><span class="line">&#125;</span><br><span class="line">a.d = <span class="number">8</span></span><br><span class="line">a[<span class="built_in">Symbol</span>(<span class="string">'b'</span>)] = <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(a)</span><br></pre></td></tr></table></figure><p>output(devtools):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">9</span>) [<span class="string">"1"</span>, <span class="string">"7"</span>, <span class="string">"10"</span>, <span class="string">"b"</span>, <span class="string">"a"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="built_in">Symbol</span>(a), <span class="built_in">Symbol</span>(b)]</span><br><span class="line">  <span class="number">0</span>: <span class="string">"1"</span></span><br><span class="line">  <span class="number">1</span>: <span class="string">"7"</span></span><br><span class="line">  <span class="number">2</span>: <span class="string">"10"</span></span><br><span class="line">  <span class="number">3</span>: <span class="string">"b"</span></span><br><span class="line">  <span class="number">4</span>: <span class="string">"a"</span></span><br><span class="line">  <span class="number">5</span>: <span class="string">"c"</span></span><br><span class="line">  <span class="number">6</span>: <span class="string">"d"</span></span><br><span class="line">  <span class="number">7</span>: <span class="built_in">Symbol</span>(a)</span><br><span class="line">  <span class="number">8</span>: <span class="built_in">Symbol</span>(b)</span><br><span class="line">  length: <span class="number">9</span></span><br></pre></td></tr></table></figure><p>Chrome çš„å®ç°ä¸è§„èŒƒçš„çº¦å®šå®Œå…¨ä¸€è‡´ğŸ˜•ï¼Œæ‰€ä»¥è‡³æ­¤æˆ‘ä»¬çŸ¥é“å®ƒä¸ºä»€ä¹ˆæ‰“å°å‡ºæ¥æ˜¯å‡åºçš„äº†ã€‚</p><p>å¦å¤–å¼•ç”¨ Chromium ç¤¾åŒºä¸Š <a href="https://bugs.chromium.org/p/v8/issues/detail?id=164" target="_blank" rel="noopener">Issue 164: Wrong order in Object properties interation</a> çš„è®¨è®ºæ‰€è¿°ï¼š</p><blockquote><p>There seems to be a widespread feeling that this used to work the way people expected it, but then the V8 team broke it in order to be mean.</p><p>What actually happened was that originally the order was completely arbitrary in V8.  At a later point it was changed so that non-numeric indices were in insertion order, and numeric indices were sometimes in insertion order.  Whether or not the numeric indices were in in insertion order was dependent on internal V8 heuristics that decide whether to use an array or a hash map implementation for the numeric indices.  Making heuristics in the V8 implementation visible in this way was felt to be undesirable so it was normalized so that numeric indices were always iterated in numeric order regardless of the internal representation.  Numeric iteration order was always a possibility, but with the last change it was made predictable.</p><p>There has never been any difference between the internal representation or iteration order of arrays vs. other objects in V8.</p><p>Here is an independent test of the way arrays and objects perform in various engines (a little out of date now): <a href="http://news.qooxdoo.org/javascript-array-performance-oddities-characteristics" target="_blank" rel="noopener">http://news.qooxdoo.org/javascript-array-performance-oddities-characteristics</a>  If this bug ever gets â€˜fixedâ€™ you can wave goodbye to some of the nice performance results in that graph.</p></blockquote><p>ç»“åˆå‰é¢ä»‹ç»çš„ V8 å±æ€§ä¸€èŠ‚æˆ‘ä»¬çŸ¥é“ï¼Œæ•°ç»„å±æ€§æ€»æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„ç©ºé—´ï¼ˆå¯èƒ½æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯èƒ½æ˜¯å­—å…¸ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå§‹ç»ˆä»¥æœ‰åºæ•°ç»„çš„çŠ¶æ€è¾“å‡ºé”®å€¼ï¼Œè¿™æ ·çš„ç»“æœæ˜¯å¯é¢„æµ‹çš„ï¼ˆå§‹ç»ˆä¸€è‡´ï¼‰ã€‚å¹¶ä¸”åœ¨ V8 å†…éƒ¨ï¼Œæ•°ç»„çš„å†…éƒ¨è¡¨ç¤ºå’Œè¿­ä»£æ–¹å¼ï¼Œå’Œå…¶å®ƒå¯¹è±¡æ²¡æœ‰ä»»ä½•ä¸åŒã€‚</p><p>ç»¼ä¸Šæ‰€è®²ï¼Œè¿™æ ·çš„å†…éƒ¨å®ç°ï¼Œæœ‰æ€§èƒ½çš„å› ç´ ï¼Œä¹Ÿæœ‰å†å²åŸå› ã€‚</p><h2 id="æœ‰æ²¡æœ‰åŠæ³•æŒ‰åŸé¡ºåºæ‰“å°ï¼Ÿ"><a href="#æœ‰æ²¡æœ‰åŠæ³•æŒ‰åŸé¡ºåºæ‰“å°ï¼Ÿ" class="headerlink" title="æœ‰æ²¡æœ‰åŠæ³•æŒ‰åŸé¡ºåºæ‰“å°ï¼Ÿ"></a>æœ‰æ²¡æœ‰åŠæ³•æŒ‰åŸé¡ºåºæ‰“å°ï¼Ÿ</h2><p>è®²äº†é‚£ä¹ˆå¤šï¼Œæˆ‘å°±æ˜¯æƒ³æŒ‰åŸé¡ºåºæ‰“å°æ€ä¹ˆåŠï¼Ÿ</p><p>é¦–å…ˆå¦‚æœç›®æ ‡ç»“æ„å·²ç»æ˜¯ JavaScript å¯¹è±¡ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰åŠæ³•äº†ã€‚æˆ‘ä»¬å›åˆ°æœ€ç»ˆçš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸² JSON æ•°ç»„ï¼Œæƒ³æŠŠå®ƒæŒ‰åŸåºè·å¾—é”®å€¼ï¼Œå¯ä»¥æ€ä¹ˆåšï¼Ÿå‡å¦‚æˆ‘ä»¬æœ‰ä¸²æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"100"</span>:<span class="string">"foo"</span>,<span class="attr">"2"</span>:<span class="string">"bar"</span>,<span class="attr">"7"</span>:<span class="string">"baz"</span>&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆèƒ½æƒ³åˆ°çš„ä¸€ä¸ªç®€å•çš„æ–¹æ³•å°±æ˜¯ï¼Œè‡ªå·±å†™ä¸€ä¸ªç®€å•çš„ json-parserã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonString = <span class="string">'&#123;"100":"foo","2":"bar","7":"baz"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parseKeys = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> out = []</span><br><span class="line">  <span class="keyword">const</span> tokens = str.slice(<span class="number">1</span>, <span class="number">-1</span>).split(<span class="string">','</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tokens.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    out.push(tokens[i].split(<span class="string">':'</span>)[<span class="number">0</span>].slice(<span class="number">1</span>, <span class="number">-1</span>))  </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// try</span></span><br><span class="line"><span class="built_in">console</span>.log(parseKeys(jsonString))  <span class="comment">// âœ… ["100", "2", "7"]</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æˆ‘ä»¬å¾—åˆ°äº†æƒ³è¦çš„ç»“æœï¼ˆyeahï¼‰ï¼Œä½†æ˜¯å¦‚æœ json æ•°ç»„ç¨å¾®å¤æ‚ç‚¹å„¿å‘¢ï¼Ÿ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"100"</span>:&#123;<span class="attr">"b"</span>:<span class="string">"foo"</span>&#125;,<span class="attr">"2"</span>:[<span class="number">1</span>,<span class="number">2</span>],<span class="attr">"7"</span>:<span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥é‡æ„ä¸‹è¿™ä¸ªè§£æå™¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parseKeys = <span class="function">(<span class="params">str, lvl = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> out = []</span><br><span class="line">  <span class="keyword">let</span> level = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> matching = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> pair = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (str.charAt(i) === <span class="string">'"'</span> &amp;&amp; level === lvl) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!matching) &#123;</span><br><span class="line">        pair[<span class="number">0</span>] = i </span><br><span class="line">      &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">        pair[<span class="number">1</span>] = i</span><br><span class="line">        out.push([...pair])</span><br><span class="line">      &#125;</span><br><span class="line">      matching = ~matching</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([<span class="string">'&#123;'</span>, <span class="string">'['</span>].indexOf(str.charAt(i) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">      level += <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([<span class="string">'&#125;'</span>, <span class="string">']'</span>].indexOf(str.charAt(i) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">      level -= <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> out.map(<span class="function"><span class="params">pair</span> =&gt;</span> str.slice(pair[<span class="number">0</span>], pair[<span class="number">1</span>]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>output(devtools):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"100"</span>, <span class="string">"2"</span>, <span class="string">"7"</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªæ–¹æ³•æ‰§è¡Œæ•ˆç‡å¹¶ä¸é«˜ï¼Œåªæ˜¯æå‡ºä¸€ç§æ€è·¯ï¼Œå½“ç„¶æˆ‘ä»¬çš„ç›®æ ‡è¿˜æ˜¯è§£æå‡º keyï¼Œè€Œä¸æ˜¯å®Œæ•´çš„å¼•å…¥ä¸€ä¸ª json è§£é‡Šå™¨ï¼Œé‚£æ ·å¯èƒ½å¾—ä¸å¿å¤±ã€‚</p><p>æ›´é«˜æ•ˆçš„è§£å†³æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹‹åå†è¡¥å……â€¦</p><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL; DR;"></a>TL; DR;</h2><p>V8 åœ¨å†…éƒ¨å°†å‘½åå±æ€§å’Œæ•°ç»„ç´¢å¼•å±æ€§åˆ†å¼€å­˜å‚¨ï¼Œå¹¶ä¸”æ•°ç»„å’Œå…¶å®ƒå¯¹è±¡çš„å†…éƒ¨å®ç°å’Œè¿­ä»£æœºåˆ¶æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><p>ç”±è§„èŒƒå®šä¹‰ï¼Œå¯¹è±¡åœ¨è¿­ä»£çš„æ—¶å€™ï¼Œæ€»æ˜¯ä»¥å‡åºè¾“å‡ºæ•°ç»„ç´¢å¼•çš„å±æ€§ã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç›®å‰å¯èƒ½è‡ªå·±å»è§£æ JSON å­—ç¬¦ä¸²ã€‚</p><p>æ›´å¤šé—®é¢˜çš„å»¶ä¼¸è®¨è®ºï¼Œè¯·å‚è€ƒ Chromium ç¤¾åŒºçš„ <strong>Issue: 164</strong> è®¨è®ºã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-ownpropertykeys" target="_blank" rel="noopener">ECMA262 Specification - OwnPropertyKeys</a></li><li><a href="https://v8.dev/blog/fast-properties" target="_blank" rel="noopener">Fast properties in V8</a></li><li><a href="https://v8.dev/blog/fast-for-in" target="_blank" rel="noopener">Fast for-in in V8</a></li><li><a href="https://bugs.chromium.org/p/v8/issues/detail?id=164" target="_blank" rel="noopener">Issue 164: Wrong order in Object properties interation</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> v8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯‘ - Why Do We Write super(props)?</title>
      <link href="/2018/11/30/fork__why_do_we_write_super/"/>
      <url>/2018/11/30/fork__why_do_we_write_super/</url>
      
        <content type="html"><![CDATA[<p><a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">React Hooks</a> æ˜¯å½“ä¸‹ç¤¾åŒºçš„çƒ­é—¨ï¼Œä½†æˆ‘å´æƒ³ä» <em>class</em> ç»„ä»¶çš„ä¸€äº›æœ‰è¶£å®ç°è®²èµ·ï¼</p><p>ç†è§£è¿™äº›å†…å®¹å¯¹ä½ å¦‚ä½•è¿ç”¨ React æ¥è¯´å¹¶ä¸é‡è¦ï¼Œä½†å¦‚æœä½ å–œæ¬¢æ¢å¯»äº‹ç‰©åŠ¨ä½œçš„åŸç†çš„è¯ï¼Œå°±å¾ˆæœ‰è¶£äº†ã€‚</p><hr><p>æˆ‘å†™è¿‡ä¸è®¡å…¶æ•°çš„ <code>super(props)</code> :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checkbox</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">isOn</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½¿ç”¨ <a href="https://github.com/tc39/proposal-class-fields" target="_blank" rel="noopener">class fields proposal</a> å¯ä»¥è®©æˆ‘çœå»è¿™ç§å†™æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checkbox</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">isOn</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React ä» 0.13 å¢åŠ å¯¹æ™®é€š class çš„æ”¯æŒå¼€å§‹ï¼Œå°±è®¡åˆ’è¦ä½¿ç”¨è¿™ç§è¯­æ³•ã€‚ç°åœ¨è¿™ç§å®šä¹‰ <code>constructor</code> ç„¶åè°ƒç”¨ <code>super(props)</code> çš„åšæ³•åªæ˜¯ <code>class field</code> æ¥ä¸´ä¹‹å‰çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆã€‚</p><a id="more"></a><p>ä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬å›åˆ°è¿™ä¸ªä¾‹å­ï¼Œåªä½¿ç”¨ ES2015 çš„ç‰¹æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lass Checkbox extends React.Component &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">isOn</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è°ƒç”¨ <code>super</code>ï¼Ÿå¯ä»¥çœå»å—ï¼Ÿå¦‚æœæˆ‘ä»¬ä¸å¾—ä¸è°ƒç”¨å®ƒï¼Œä¸ä¼  <code>props</code> ä¼šæ€ä¹ˆæ ·ï¼Ÿé™¤äº† <code>props</code> è¿˜éœ€è¦ä¼ é€’åˆ«çš„å‚æ•°å—ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p><hr><p>åœ¨ JavaScript ä¸­, <code>super</code> æŒ‡çš„æ˜¯çˆ¶ç±»çš„ constructorï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæŒ‡çš„å°±æ˜¯ React.Componentï¼‰</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ constructor ä¸­ï¼Œä½ åªèƒ½åœ¨è°ƒç”¨çˆ¶ç±»çš„ constructor ä¹‹åæ‰èƒ½ä½¿ç”¨ <code>this</code>ï¼ŒJavaScript ä¸ä¼šè®©ä½ è¿™æ ·åšï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checkbox</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ Canâ€™t use `this` yet</span></span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// âœ… Now itâ€™s okay though</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">isOn</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±è¯´æ˜ä¸ºä»€ä¹ˆ JavaScript å¼ºåˆ¶ä½ åœ¨ä½¿ç”¨ <code>this</code> ä¹‹å‰è¦æ‰§è¡Œçˆ¶ç±»çš„ constructorï¼Œå‚è€ƒä¸‹é¢è¿™ä¸ªç±»ç»“æ„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PolitePerson</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greetColleagues(); <span class="comment">// ğŸ”´ This is disallowed, read below why</span></span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  greetColleagues() &#123;</span><br><span class="line">    alert(<span class="string">'Good morning folks!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨è°ƒç”¨ <code>super</code> ä¹‹å‰å°±è°ƒç”¨äº† <code>this</code>ï¼Œä¸€ä¸ªæœˆä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½ä¿®æ”¹äº† <code>greetColleagues</code> æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">greetColleagues() &#123;</span><br><span class="line">  alert(<span class="string">'Good morning folks!'</span>);</span><br><span class="line">  alert(<span class="string">'My name is '</span> + <span class="keyword">this</span>.name + <span class="string">', nice to meet you!'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬å¿˜è®°äº† <code>this.greetColleagues()</code> æ˜¯åœ¨ <code>super()</code> ä¹‹å‰è°ƒç”¨çš„ï¼Œè¿™ä¸ªæ—¶å€™ <code>this.name</code> è¿˜æ²¡æœ‰è¢«å®šä¹‰ï¼æ‰€ä»¥åƒè¿™æ ·çš„ä»£ç å°±å¾ˆä¸å¥½ç»´æŠ¤ã€‚</p><p>ä¸ºäº†é¿å¼€è¿™ä¸ªé™·é˜±ï¼Œ<strong>JavaScript å¼ºåˆ¶ä½ å¦‚æœæƒ³è¦åœ¨ constructor ä¸­ä½¿ç”¨ <code>this</code>ï¼Œåˆ™å¿…é¡»å…ˆè°ƒç”¨ <code>super</code></strong>ï¼Œè®©çˆ¶ç±»å…ˆå¤„ç†å®Œè¯¥åšçš„äº‹æƒ…ï¼è¿™ä¸ªé™åˆ¶ä¹Ÿé€‚ç”¨äºä½¿ç”¨ç±»æ¥å®šä¹‰ React ç»„ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props);</span><br><span class="line">  <span class="comment">// âœ… Okay to use `this` now</span></span><br><span class="line">  <span class="keyword">this</span>.state = &#123; <span class="attr">isOn</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±åªå‰©ä¸‹å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦ä¼ é€’ <code>props</code> å‚æ•°ï¼Ÿ</p><hr><p>ä½ å¯èƒ½è®¤ä¸ºå‘ <code>super</code> ä¼ é€’ <code>props</code> æ˜¯æœ‰å¿…è¦çš„ï¼Œä»¥ä¾¿ <code>React.Component</code> çš„ constructor å¯ä»¥åˆå§‹åŒ– <code>this.props</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.props = props;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¹Ÿå·®ä¸å¤šï¼Œå‡†ç¡®åœ°è¯´ï¼Œè¿™æ˜¯<a href="https://github.com/facebook/react/blob/1d25aa5787d4e19704c049c3cfa985d3b5190e0d/packages/react/src/ReactBaseClasses.js#L22" target="_blank" rel="noopener">å®ƒçš„è¿‡ç¨‹</a></p><p>ä½†ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå³ä½¿ä½ æ²¡æœ‰æŠŠ <code>props</code> å‚æ•°ä¼ é€’ç»™ <code>super()</code>ï¼Œä½ è¿˜æ˜¯å¯ä»¥åœ¨ <code>render</code> å’Œå…¶å®ƒæ–¹æ³•ä¸­è®¿é—® <code>this.props</code>ã€‚ï¼ˆä¸ä¿¡çš„è¯å¯ä»¥è¯•è¯•çœ‹ï¼‰</p><p>æ‰€ä»¥å®ƒå†…éƒ¨æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿäº‹å®ä¸Šï¼ŒReact ä¼šåœ¨ä½ è°ƒç”¨ constructor ä¹‹åé‡æ–°èµ‹å€¼ <code>props</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">new</span> YourComponent(props);</span><br><span class="line">instance.props = props;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å³ä½¿ä½ å¿˜äº†æŠŠ <code>props</code> ä¼ é€’ç»™ <code>super()</code>ï¼ŒReact ä¹Ÿä¼šåœ¨ä¹‹åæ­£ç¡®çš„èµ‹å€¼ï¼Œè¿™å°±æ˜¯åŸå› ã€‚</p><p>å½“ React æ”¯æŒ class çš„æ—¶å€™ï¼Œå¹¶ä¸åªæ˜¯ç®€å•çš„æ·»åŠ äº† ES6 çš„ç‰¹æ€§ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å°½å¯èƒ½å¹¿æ³›æŠ½è±¡åœ°æ”¯æŒ classã€‚å› ä¸ºä¸èƒ½ç¡®å®š ClojureScriptã€CoffeeScriptã€ES6ã€Fableã€Scala.jsã€TypeScript æˆ–å…¶å®ƒçš„æ–¹å¼æ˜¯å¦‚ä½•å®šä¹‰ä¸€ä¸ªç»„ä»¶çš„ï¼Œæ‰€ä»¥ React æ•…æ„åœ°ä¸å…³å¿ƒ <code>super()</code> æ–¹æ³•æœ‰æ²¡æœ‰è¢«è°ƒç”¨â€”â€”å°½ç®¡è¿™æ˜¯ ES6 class è§„å®šçš„</p><p>æ‰€ä»¥ï¼Œè¿™æ˜¯ä¸æ˜¯å°±æ„å‘³ç€ï¼Œä½ å¯ä»¥åªå†™ <code>super()</code> è€Œä¸ç”¨ <code>super(props)</code> äº†ï¼Ÿ</p><p><strong>ææ€•å¹¶ä¸æ˜¯è¿™æ ·ï¼Œå› ä¸ºå®ƒä¾ç„¶ä»¤äººå›°æƒ‘ã€‚</strong> å½“ç„¶ï¼ŒReact ä¼šåœ¨ constructor ä¹‹åé‡æ–°èµ‹å€¼ <code>this.props</code>ï¼Œä½†æ˜¯åœ¨ constructor å†…éƒ¨è°ƒç”¨äº† <code>super</code> ä¹‹åï¼Œ<code>this.props</code> ä¾ç„¶æ˜¯ <code>undefined</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.props = props;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inside your code</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(); <span class="comment">// ğŸ˜¬ We forgot to pass props</span></span><br><span class="line">    <span class="built_in">console</span>.log(props);      <span class="comment">// âœ… &#123;&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props); <span class="comment">// ğŸ˜¬ undefined </span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯åœ¨ constructor ä¸­è°ƒç”¨çš„æŸäº›æ–¹æ³•ä¸­é‡åˆ°äº†è¿™ç§é—®é¢˜ï¼Œå°±æ›´éš¾å®šä½äº†ã€‚<strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å¼ºè°ƒè¦åšæŒ<code>super(props)</code>ï¼Œå³ä½¿æ²¡æœ‰ä¸¥æ ¼é™åˆ¶</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props); <span class="comment">// âœ… We passed props</span></span><br><span class="line">    <span class="built_in">console</span>.log(props);      <span class="comment">// âœ… &#123;&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props); <span class="comment">// âœ… &#123;&#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥ä¿è¯ <code>this.props</code> åœ¨ constructor æ‰§è¡Œå®Œä¹‹å‰å°±æ­£ç¡®èµ‹å€¼ã€‚</p><hr><p>è¿˜æœ‰æœ€åä¸€ä¸ª React ç”¨æˆ·å¯èƒ½ä¼šå›°æƒ‘çš„é—®é¢˜ã€‚</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œå½“ä½ ä½¿ç”¨ Context API çš„æ—¶å€™ï¼ˆæ— è®ºæ˜¯æ—§çš„ <code>contextTypes</code> æˆ–è€…åœ¨ React 16.6 ä¸­æ–°æ·»åŠ çš„ <code>contextType</code> APIï¼‰ï¼Œ<code>context</code> æ˜¯ constructor çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</p><p>æ‰€ä»¥ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å†™æˆ <code>super(props, context)</code>ï¼Ÿç¡®å®å¯ä»¥è¿™æ ·å†™ï¼Œä½†æ˜¯ context ç”¨çš„ç›¸å¯¹æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥ä¹Ÿä¸å®¹æ˜“ç¢°åˆ°è¿™ä¸ªé™·é˜±ã€‚</p><p>å¦‚æœä½¿ç”¨ class fields proposal çš„è¯ï¼Œè¿™ä¸ªé™·é˜±å°±ä¸å¤å­˜åœ¨äº†ã€‚ä¸éœ€è¦ç‰¹åˆ«åœ°å†™ä¸€ä¸ª constructorï¼Œæ‰€ä»¥çš„å˜é‡éƒ½å¯ä»¥è‡ªåŠ¨ä¼ é€’ã€‚è¿™æ ·ä¹Ÿå¯ä»¥åœ¨ <code>state = {}</code> ä¸­ç›´æ¥å¼•ç”¨ <code>this.props</code> æˆ– <code>this.context</code> äº†ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨ React Hooks çš„è¯ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦ä½¿ç”¨ <code>super</code> æˆ– <code>this</code>ï¼Œä½†è¿™æ˜¯ä»¥åçš„äº‹å„¿äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
            <tag> reprinted </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨ Immutable æ•°æ®æ¥ä¼˜åŒ– React åº”ç”¨</title>
      <link href="/2018/05/29/optimizing-react-app-with-immutable-data/"/>
      <url>/2018/05/29/optimizing-react-app-with-immutable-data/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´ä»¥æ¥ï¼ŒVirtual DOM éƒ½æ˜¯ React çš„ä¸€å¤§ç‰¹è‰²ï¼ŒFacebook å®£ç§° React å€Ÿå…¶èƒ½å¾ˆå¤§ç¨‹åº¦æé«˜ SPA çš„æ€§èƒ½è¡¨ç°ã€‚ä½†è¿™å°±æ„å‘³ç€ React çš„æ€§èƒ½ä¸€å®šä¼˜ç§€å—ï¼Œå¯èƒ½å¹¶ä¸æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒReact æ…¢çš„ä»¤äººæŠ“ç‹‚ï¼Œè¿™æ—¶ä½ å¯èƒ½å°±éœ€è¦ç”¨ä¸€äº›æ­£ç¡®çš„æ‰‹æ®µæ¥ä¼˜åŒ–å®ƒäº†ã€‚</p><h2 id="React-çš„æ›´æ–°æœºåˆ¶"><a href="#React-çš„æ›´æ–°æœºåˆ¶" class="headerlink" title="React çš„æ›´æ–°æœºåˆ¶"></a>React çš„æ›´æ–°æœºåˆ¶</h2><p>æˆ‘ä»¬ä¸å¦¨å…ˆç®€å•äº†è§£ä¸‹ React çš„æ›´æ–°æœºåˆ¶ï¼Œå¦‚æœèƒ½é™ä½å®ƒçš„æ›´æ–°é¢‘ç‡ï¼Œè‡ªç„¶èƒ½å¤§å¤§æé«˜æ•´ä½“æ¸²æŸ“é€Ÿåº¦ã€‚</p><h3 id="Props-amp-State"><a href="#Props-amp-State" class="headerlink" title="Props &amp; State"></a>Props &amp; State</h3><p>props å’Œ state çš„åŸºæœ¬æ¦‚å¿µä¸å†èµ˜è¿°ï¼Œç»„ä»¶çš„ props æ˜¯åªè¯»çš„ï¼Œåªèƒ½é€šè¿‡ä¸Šå±‚ JSX å£°æ˜æ—¶çš„å±æ€§ä¼ é€’è¿›æ¥ï¼Œstate åˆ™å®Œå…¨å—ç»„ä»¶è‡ªèº«æ§åˆ¶ï¼Œå¹¶ä¸”åªå­˜åœ¨äº <code>class</code> è¯­æ³•å£°æ˜çš„ç»„ä»¶ã€‚</p><p>æ— è®ºæ˜¯ props è¿˜æ˜¯ state å‘ç”Ÿå˜åŒ–éƒ½å¯ä»¥è§¦å‘ç»„ä»¶æ›´æ–°ï¼Œä¸‹é¢è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è¢«ä¾æ¬¡è°ƒç”¨ï¼š</p><ul><li>componentWillReceiveProps*</li><li>static getDerivedStateFromProps</li><li>shouldComponentUpdate</li><li>componentWillUpdate*</li><li>render</li><li>getSnapshotBeforeUpdate</li><li>componentDidUpdate</li></ul><a id="more"></a><blockquote><p><code>*</code> å·æ ‡æ³¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å°†ä¼šåœ¨ React 17 ç§»é™¤ï¼Œä¸€æ—¦è°ƒç”¨äº†æ–°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨ã€‚</p></blockquote><p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1frj8i1dy0jj30aq0g9dgp.jpg" alt="Update lifecycle"></p><p>ä»ä¸Šé¢çš„ç”Ÿå‘½å‘¨æœŸä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>shouldComponentUpdate</code> æ–¹æ³•å°†åœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props æˆ–è€… state æ—¶è¢«è°ƒç”¨ã€‚ç„¶è€Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ æ¯æ¬¡æ›´æ–°ï¼ŒReact éƒ½ä¼šå»è°ƒç”¨ <strong>render</strong> æ–¹æ³•é‡æ–°ç”Ÿæˆ Virtual DOM å¹¶é€šè¿‡ diff ç®—æ³•è®¡ç®—å‡ºéœ€è¦å˜åŠ¨çš„éƒ¨åˆ†ï¼Œç„¶åæ“ä½œ DOM å®Œæˆè¿™éƒ¨åˆ†æ›´æ–°ã€‚</p><p>å¯¹äºä¸€äº›ç®€å•çš„ React åº”ç”¨æ¥è¯´ï¼Œæ¯æ¬¡ <strong>render</strong> å¸¦æ¥çš„æ¶ˆè€—ä¸ä¼šç‰¹åˆ«å¤§ï¼Œä¸è¿‡ä¸€æ—¦ä½ çš„åº”ç”¨æœ‰äº†ä¸€å®šè§„æ¨¡ï¼Œå°¤å…¶æ˜¯å¤æ‚çš„æ ‘å½¢ç»“æ„æ—¶ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šæ¶ˆè€—ä¸å°‘çš„ç³»ç»Ÿèµ„æºã€‚</p><h3 id="shouleComponentUpdateï¼ˆSCUï¼‰"><a href="#shouleComponentUpdateï¼ˆSCUï¼‰" class="headerlink" title="shouleComponentUpdateï¼ˆSCUï¼‰"></a>shouleComponentUpdateï¼ˆSCUï¼‰</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹<a href="https://reactjs.org/docs/optimizing-performance.html#shouldcomponentupdate-in-action" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>é‡Œçš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1frsifbmx0kj30tc0oitci.jpg" alt></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªç®€å•çš„æ ‘å½¢ç»“æ„ä¸­ï¼Œä»…ä»…æ˜¯ c7 çš„çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½è¦è¿›è¡Œä¸€æ¬¡ <strong>render</strong>ï¼Œé‚£å¦‚æœæˆ‘è¿™ä¸ªæ ‘ä¸‹æœ‰ 10 ä¸ªç»„ä»¶å‘¢ï¼Œ50 ä¸ªå‘¢ï¼Ÿå°¤å…¶å½“è¿™ä¸ª c7 çš„çŠ¶æ€å˜åŒ–ä¸é¼ æ ‡ç§»åŠ¨è¿™ç§é«˜é¢‘æ“ä½œç›¸å…³æ—¶ï¼Œæ‰€æœ‰çš„ç»„ä»¶ä¸åœçš„é‡æ–°ç”Ÿæˆ Virtual DOMï¼Œè¿™æ ·èƒ½æœ‰å¤šå¡é¡¿ä½ èƒ½æƒ³è±¡çš„åˆ°å—ï¼Ÿä¸è¦é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼ŒæŸå¤© Leader å«æˆ‘å†™äº†ä¸ªè¡¨å•è®¾è®¡å™¨â€¦â€¦</p><p>å¦‚æœä¸ç”¨ <strong>SCU</strong> å¯¹ React çš„æ›´æ–°è¿›è¡Œé™åˆ¶ï¼Œä½ å¯èƒ½åƒæˆ‘ä¹‹å‰ä¸€æ ·ï¼Œå¯¹ç€ Chrome çš„ Perfomance å·¥å…·é‡Œé”¯é½¿èˆ¬çš„ç«ç„°å›¾æŸæ‰‹æ— ç­–ã€‚é‚£å‡å¦‚ <strong>SCU</strong> å¯ä»¥æ­£ç¡®çš„æ„ŸçŸ¥æ•°æ®å˜åŒ–å¹¶è¿”å›ä½ æœŸå¾…çš„ç»“æœï¼Œå®é™…æƒ…å†µåˆä¼šå¦‚ä½•å‘¢ï¼Ÿ</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1frsixpjyzij30sv0oi0w9.jpg" alt></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¦‚æœ <strong>SCU</strong> æ­£å¸¸å·¥ä½œï¼Œåªä¼šå‘ç”Ÿ 3 æ¬¡ Virtual DOM çš„æ¯”è¾ƒï¼Œæ¢è¨€ä¹‹ï¼Œåªæœ‰å‘ç”Ÿæ”¹å˜çš„ c7 ä»¥åŠå®ƒçš„çˆ¶çº§ç»„ä»¶ä¼šè¿›å…¥ <strong>render</strong> æ–¹æ³•ï¼Œç”Ÿæˆ Virtual DOMã€‚é‚£è¿™æ¬¡å¦‚æœæˆ‘ä»¬æœ‰ 100 ä¸ªå­ç»„ä»¶ï¼Œä½† c7 çš„æ·±åº¦è¿˜æ˜¯ 3 å‘¢ï¼Ÿæ²¡é”™ï¼Œå®ƒä¾ç„¶æ˜¯åªä¼šè°ƒç”¨ 3 æ¬¡ <strong>render</strong> æ–¹æ³•ï¼Œåœ¨å¤§å‹æ ‘å½¢ç»“æ„é‡Œï¼Œè¿™æ ·çš„æ¸²æŸ“æ•ˆç‡æ— ç–‘æ˜¯æˆå‡ ä½•å€æå‡ã€‚</p><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œ<strong>SCU</strong> æ˜¯ä¸€å®šè¦å®ç°çš„ï¼Œä½†åœ¨æ¯ä¸ªç»„ä»¶ä¸­éƒ½æ‰‹å†™ <strong>SCU</strong>ï¼Œæ‰‹åŠ¨åœ°æ¯”è¾ƒå¤æ‚çš„å¯¹è±¡ä¸­æ¯ä¸ªé”®çš„å€¼ï¼Œéš¾åº¦éåŒä¸€èˆ¬ï¼Œé‚£ä¹ˆå¦‚ä½•è½»æ¾åœ°è®© <strong>SCU</strong> è¿”å›ä½ æœŸå¾…çš„ç»“æœï¼Ÿ</p><h2 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h2><p>è™½ç„¶å®Œå…¨æ‰‹å†™ <strong>SCU</strong> ä¸ç°å®ï¼Œä½†è¿™é‡Œä¾ç„¶æœ‰ä¸€äº›ç»„åˆæ–¹æ¡ˆå¯ä»¥åŠ©æˆ‘ä»¬å®ç°ç›®æ ‡ã€‚</p><h3 id="PureComponent"><a href="#PureComponent" class="headerlink" title="PureComponent"></a>PureComponent</h3><p>PureComponent æ˜¯ React æä¾›çš„å¦ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒé»˜è®¤å¸®ä½ å®ç°äº† <strong>SCU</strong> æ–¹æ³•ï¼Œå…¶å®åœ¨å®ƒå‡ºç°ä¹‹å‰ï¼Œå®ƒçš„å‰èº«æ˜¯ React çš„ addons æä¾›çš„ PureRenderMixinï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shallowEqual = <span class="built_in">require</span>(<span class="string">'fbjs/lib/shallowEqual'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  shouldComponentUpdate: <span class="function"><span class="keyword">function</span>(<span class="params">nextProps, nextState</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      !shallowEqual(<span class="keyword">this</span>.props, nextProps) ||</span><br><span class="line">      !shallowEqual(<span class="keyword">this</span>.state, nextState)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒå¸®æˆ‘ä»¬å®ç°äº† <strong>SCU</strong> æ–¹æ³•ï¼Œå®ç°çš„æœºåˆ¶æ˜¯æµ…æ¯”è¾ƒï¼ˆShallow Compareï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªç®€å•çš„æ¯”è¾ƒäº† <code>this.props</code> å’Œ <code>nextProps</code> ä¸¤ä¸ªå˜é‡ï¼ˆä»¥åŠä»–ä»¬çš„ç¬¬ä¸€å±‚å­å±æ€§ï¼‰å¼•ç”¨çš„æ˜¯å¦ä¸ºåŒä¸€ä¸ªåœ°å€ï¼Œå¦‚æœæ˜¯åˆ™è¿”å› <strong>false</strong>ï¼Œå¦åˆ™è¿”å› <strong>true</strong>ã€‚</p><blockquote><p><code>shallowEqual</code> çš„å…·ä½“å®ç°è¯·æŸ¥é˜…<a href="https://github.com/facebook/fbjs/blob/master/packages/fbjs/src/core/shallowEqual.js" target="_blank" rel="noopener">æºç </a></p></blockquote><p>åŒæ ·çš„æˆ‘ä»¬ä¹Ÿæ¥çœ‹ä¸‹ä½¿ç”¨ PureComponent æ—¶çš„å…·ä½“å®ç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkShouldComponentUpdate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  ...</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> instance = workInProgress.stateNode;</span><br><span class="line">  <span class="keyword">const</span> ctor = workInProgress.type;</span><br><span class="line">  <span class="comment">// ç”¨æˆ·è‡ªå·±å®ç°</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> instance.shouldComponentUpdate === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> shouldUpdate = instance.shouldComponentUpdate(</span><br><span class="line">      newProps,</span><br><span class="line">      newState,</span><br><span class="line">      newContext,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> shouldUpdate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ctor.prototype &amp;&amp; ctor.prototype.isPureReactComponent) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç”¨æˆ·ä¸å®šä¹‰ <strong>SCU</strong> æ–¹æ³•ï¼Œå¹¶ä¸”å½“å‰ç»„ä»¶ä¸º PureComponent æ—¶ï¼Œæœ€ç»ˆä¾ç„¶ä¼šå¯¹æ–°æ—§ Props å’Œ State è¿›è¡Œä¸€ä¸ªæµ…æ¯”è¾ƒã€‚</p><p>è™½ç„¶ PureComponent å¸®æˆ‘ä»¬å®ç°äº† <strong>SCU</strong> æ–¹æ³•ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å·²ç»è¾¾åˆ°ç›®æ ‡äº†ï¼Œåˆ«å¿˜äº†å®ƒåªæ˜¯å®ç°äº†æµ…æ¯”è¾ƒï¼Œåœ¨ JavaScript ä¸­ï¼ŒPrimitive æ•°æ®èƒ½ç›´æ¥çš„ç”¨ <code>=</code> å·ç®€å•çš„æµ…æ¯”è¾ƒï¼Œè€Œ Object æ•°æ®ä»…ä»…è¡¨ç¤ºä¸¤ä¸ªå˜é‡å¼•ç”¨çš„å †åœ°å€ç›¸åŒï¼Œä½†è¿™å—å„¿å†…å­˜ä¸­çš„æ•°æ®æœ‰æ²¡æœ‰æ”¹åŠ¨è¿‡ï¼Œå°±æ— ä»å¾—çŸ¥äº†ï¼Œçœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oldState = &#123; <span class="attr">expand</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">oldState.expand = <span class="literal">false</span>;</span><br><span class="line">newState = oldState;</span><br><span class="line"></span><br><span class="line">shallowEqual(newState, oldState) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>  å¦‚ä¸Šæˆ‘ä»¬æ›´æ–°äº† state çš„ expand çš„å€¼ï¼Œä½† PureComponent åœ¨æ¯”è¾ƒæ—¶ä¼šè®¤ä¸º state å¹¶æ²¡æœ‰æ›´æ–°è¿”å› <strong>SCU</strong> è¿”å› <code>false</code>ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç»„ä»¶å°±å¾—ä¸åˆ°æ­£ç¡®çš„æ›´æ–°äº†ã€‚</p><h3 id="æ·±æ‹·è´å°±è¡Œäº†ï¼Œæ˜¯è¿™æ ·å—"><a href="#æ·±æ‹·è´å°±è¡Œäº†ï¼Œæ˜¯è¿™æ ·å—" class="headerlink" title="æ·±æ‹·è´å°±è¡Œäº†ï¼Œæ˜¯è¿™æ ·å—"></a>æ·±æ‹·è´å°±è¡Œäº†ï¼Œæ˜¯è¿™æ ·å—</h3><p>å¯èƒ½æ¯”è¾ƒæœ‰ç»éªŒçš„ç«¥é‹ä¼šè¯´ï¼Œåªè¦ç”¨æ·±æ‹·è´å°±è¡Œäº†ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸‹å‡ ç§å¸¸è§çš„æ·±æ‹·è´å®ç°</p><h4 id="JSON-ä¹‹-stringify-parse"><a href="#JSON-ä¹‹-stringify-parse" class="headerlink" title="JSON ä¹‹ stringify + parse"></a>JSON ä¹‹ stringify + parse</h4><p>è¿™ä¸ªåŸç†æ¯”è¾ƒç®€å•ï¼Œåºåˆ—åŒ–ä¹‹åï¼Œå¯¹è±¡å˜æˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>JSON.parse</code> ä¼šä»å­—ç¬¦ä¸²é‡æ–°ç”Ÿæˆå¯¹è±¡ï¼Œå¾ˆæ˜æ˜¾è¿™å·²ç»ä¸æ˜¯ä¹‹å‰é‚£ä¸ªå¯¹è±¡äº†ï¼Œå®ç°äº†å®Œå…¨çš„æ·±æ‹·è´ã€‚ä½†æ˜¯åˆ«å¿˜äº†ï¼ŒJSON åªæœ‰ 6 ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™æ ·è½¬æ¢å¾ˆæ˜¾ç„¶ä¸å°‘å¯¹è±¡ä¼šå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚ Function å¯¹è±¡ï¼ŒDate å¯¹è±¡ç­‰ç­‰ï¼Œéƒ½æ— æ³•æ­£å¸¸è½¬æ¢ã€‚å¯è§è¿™ç§æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯ä¹Ÿæ˜¯æ¯”è¾ƒå°‘çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="literal">false</span>,</span><br><span class="line">  c: <span class="string">'react'</span>,</span><br><span class="line">  d: <span class="literal">null</span>,</span><br><span class="line">  e: [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  f: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Forget me!'</span>) &#125;,</span><br><span class="line">  g: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  h: <span class="regexp">/forget me/g</span>,</span><br><span class="line">  i: [<span class="number">1</span>, <span class="keyword">new</span> <span class="built_in">Date</span>()],</span><br><span class="line">  j: <span class="built_in">Symbol</span>(<span class="string">'Forget me'</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(<span class="built_in">JSON</span>.parse(o)));</span><br></pre></td></tr></table></figure><p>Output:</p><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1frt9x393n1j30gf054t94.jpg" alt></p><h4 id="lodash-cloneDeep"><a href="#lodash-cloneDeep" class="headerlink" title="lodash.cloneDeep"></a>lodash.cloneDeep</h4><p>ç›¸è¾ƒäºç”¨ JSON ç²—æš´çš„è½¬æ¢ï¼Œlodash çš„å¤„ç†æ›´ä¸ºç»†è‡´ï¼ŒPrimitive æ•°æ®ç›´æ¥è¿”å›ï¼ŒObject æ•°æ®åˆ™é€ä¸€å¤„ç†ã€‚</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œlodash çš„è¾“å‡ºç»“æœï¼š</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1frt9wmakpgj30fh05zmxp.jpg" alt></p><p>ç±»ä¼¼çš„è¿˜æœ‰ jQuery çš„ extend æ–¹æ³•ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸º true æ—¶ä¸ºæ·±æ‹·è´ï¼‰ã€‚è™½ç„¶æ·±æ‹·è´å¸®æˆ‘ä»¬é‡æ–°å¤„ç†äº†æµ…æ¯”è¾ƒçš„é—®é¢˜ï¼Œä½†å½“ä½ ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¼šå‘ç°ï¼Œæ¯æ¬¡ä¿®æ”¹æ ‘å½¢ç»“æ„çš„é‡Œçš„ä¸€ä¸ªå€¼ï¼Œæ‰€æœ‰çš„ç»„ä»¶ä¾ç„¶ä¼šå…¨éƒ¨æ¸²æŸ“ã€‚è¿™æ˜¯å› ä¸ºæ ‘å½¢ç»“æ„ä¸­æ‰€æœ‰çš„å¯¹è±¡å¼•ç”¨åœ°å€éƒ½è¢«æ”¹å˜äº†ï¼ŒPureComponent åœ¨æµ…æ¯”è¾ƒæ—¶ï¼Œè‡ªç„¶æ‰€æœ‰çš„ <strong>SCU</strong> éƒ½ä¼šè¿”å› tureï¼Œæˆ‘ä»¬ä¼¼ä¹åˆå›åˆ°äº†èµ·ç‚¹ï¼Œé‚£å¦‚ä½•åªè®©å˜åŠ¨çš„éƒ¨åˆ†æ”¹å˜å¼•ç”¨å‘¢ï¼Ÿ</p><h3 id="ä¼˜é›…çš„-Immutable-æ•°æ®"><a href="#ä¼˜é›…çš„-Immutable-æ•°æ®" class="headerlink" title="ä¼˜é›…çš„ Immutable æ•°æ®"></a>ä¼˜é›…çš„ Immutable æ•°æ®</h3><p>Immutable å³ä¸å¯å˜çš„ï¼Œæ„æ€æ˜¯å¯¹è±¡åˆ›å»ºåï¼Œæ— æ³•é€šè¿‡ç®€å•çš„èµ‹å€¼æ›´æ”¹å€¼æˆ–å¼•ç”¨ã€‚Facebook æ¨å‡ºäº† ImmutableJS æ¥å®ç°è¿™å¥—æœºåˆ¶ï¼Œå®ƒæœ‰è‡ªå·±çš„ä¸€å¥— API æ¥å¯¹å·²æœ‰çš„ Immutable å¯¹è±¡è¿›è¡Œä¿®æ”¹å¹¶è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œä½†ä¸æ·±æ‹·è´ä¸åŒï¼Œè¿™ä¸ªå¯¹è±¡åªä¿®æ”¹äº†å˜åŠ¨çš„éƒ¨åˆ†ï¼Œç¤ºæ„å¦‚ä¸‹ï¼š</p><p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1frt9vy605zj30lz0ctq47.jpg" alt></p><h4 id="ImmutableJS"><a href="#ImmutableJS" class="headerlink" title="ImmutableJS"></a>ImmutableJS</h4><p>Facebook æ¨èä½¿ç”¨ ImmutableJS æ¥ä¼˜åŒ– React åº”ç”¨ï¼Œä½†ä½¿ç”¨å®ƒçš„åŒæ—¶ä¹Ÿæ„å‘³éœ€è¦é‡æ–°å­¦ä¹ å¤§é‡çš„ API</p><h4 id="Immutability-helper"><a href="#Immutability-helper" class="headerlink" title="Immutability-helper"></a>Immutability-helper</h4><p>Immutability-helper åŸæ¥æ˜¯ React çš„ addons é‡Œé¢çš„ update æ¨¡å—ï¼Œç‹¬ç«‹å‡ºæ¥ååˆæ–°å¢äº†æ‹“å±•æ¨¡å—ï¼Œå®ƒæä¾›äº†ä¸€ç§è¯­æ³•ç³–ï¼Œä½ å¯ä»¥ç›´æ¥æè¿°éœ€è¦ä¿®æ”¹çš„å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨é¢„ç½®å‘½ä»¤å¯¹è¿™éƒ¨åˆ†è¿›è¡Œä¿®æ”¹ï¼Œæœ€åè¿”å›ä¸€ä¸ªä¿®æ”¹åçš„å¯¹è±¡ï¼Œä»¥æ­¤æ¥æ¨¡æ‹Ÿ Immutable æ•°æ®çš„è¡Œä¸º</p><p>extend çš„è¡Œä¸ºä¸ Object.assign ä¸€è‡´ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newData = extend(myData, &#123;</span><br><span class="line">  x: extend(myData.x, &#123;</span><br><span class="line">    y: extend(myData.x.y, &#123;<span class="attr">z</span>: <span class="number">7</span>&#125;),</span><br><span class="line">  &#125;),</span><br><span class="line">  a: extend(myData.a, &#123;<span class="attr">b</span>: myData.a.b.concat(<span class="number">9</span>)&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ immutability-helper:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> update <span class="keyword">from</span> <span class="string">'immutability-helper'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newData = update(myData, &#123;</span><br><span class="line">  x: &#123;<span class="attr">y</span>: &#123;<span class="attr">z</span>: &#123;<span class="attr">$set</span>: <span class="number">7</span>&#125;&#125;&#125;,</span><br><span class="line">  a: &#123;<span class="attr">b</span>: &#123;<span class="attr">$push</span>: [<span class="number">9</span>]&#125;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é€šè¿‡è¿™ä¸ªåº“æä¾›çš„è¯­æ³•ç³–ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¿«é€Ÿæ¸…æ™°ä¾¿æ·çš„ä¿®æ”¹å¯¹è±¡ï¼Œè€Œä¸ç”¨ä¸€å±‚ä¸€å±‚åœ°ç”¨ Object.assign ä¹‹ç±»çš„åŒ…èµ·æ¥ã€‚è¿™ç§æ–¹å¼ç›¸è¾ƒäº ImmutableJS æ¯”è¾ƒæ²¡æœ‰ä¾µå…¥æ€§ï¼Œæ€§èƒ½ä¹Ÿä¸æ¯” Immutable å·®å¤šå°‘ï¼ˆæœ‰å¾…æµ‹è¯•ï¼‰ï¼Œæ²¡æœ‰å­¦ä¹ æˆæœ¬ï¼Œæ¯”è¾ƒ<strong>æ¨è</strong>ï¼</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å…¶å®è¯´åˆ°è¿™é‡Œï¼Œæœ¬ç¯‡åŸºæœ¬å·²ç»ç»“æŸäº†ï¼Œåœ¨ PureComponent å’Œ Immutable Data çš„æ­é…ä½¿ç”¨ä¸‹ï¼Œ<strong>SCU</strong> èƒ½å¾ˆå¤§ç¨‹åº¦æé«˜ React åº”ç”¨çš„æ€§èƒ½ï¼Œä¸è¿‡è¿™ä¹Ÿåªæ˜¯ä»ç»„ä»¶æ›´æ–°çš„è§’åº¦æ¥ä¼˜åŒ– Reactï¼Œå®é™…ä¸Šæˆ‘ä»¬èƒ½åšçš„äº‹è¿˜æœ‰å¾ˆå¤šã€‚</p><h2 id="é—®é¢˜ä¸å»ºè®®"><a href="#é—®é¢˜ä¸å»ºè®®" class="headerlink" title="é—®é¢˜ä¸å»ºè®®"></a>é—®é¢˜ä¸å»ºè®®</h2><p>ä¸Šæ–‡åªæ˜¯ä½œè€…æœ¬äººåœ¨ React ä¼˜åŒ–ä¸­çš„å®è·µï¼Œç¿»é˜…ç½‘ä¸Šçš„èµ„æ–™ä¸æºç æ€»ç»“è€Œå‡ºçš„ä¸€ç¯‡åˆ†äº«ï¼Œå¦‚æœ‰è°¬è¯¯æ¬¢è¿æŒ‡æ­£ï¼</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://reactjs.org/docs/optimizing-performance.html" target="_blank" rel="noopener">Optimizing Performance - reactjs.org</a></li><li><a href="https://medium.com/dailyjs/react-is-slow-react-is-fast-optimizing-react-apps-in-practice-394176a11fba" target="_blank" rel="noopener">React is Slow, React is Fast: Optimizing React Apps in Practice - Daily JS</a></li></ol><h3 id="å›¾å½¢ç´ æ"><a href="#å›¾å½¢ç´ æ" class="headerlink" title="å›¾å½¢ç´ æ"></a>å›¾å½¢ç´ æ</h3><p><a href="https://github.com/liangzr/blog/blob/master/assets/optimizing-react-app-with-immutable-data.key" target="_blank" rel="noopener">optimizing-react-app-with-immutable-data.key</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/1970/01/01/hello-world/"/>
      <url>/1970/01/01/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
